<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Circlee</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Circlee</h1>
      <h2 class="project-tagline">circlee&#39;s page</h2>
      <a href="https://github.com/circlee/circlee" class="btn">View on GitHub</a>
      <a href="https://github.com/circlee/circlee/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/circlee/circlee/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
     

    <h1>이건 내 페이지다 </h1>
      <ul>
        <li v-for="(key, item) in msgData">
          <div>
            {{item}} - {{key}}
          </div>
        </li>
      </ul>
      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/circlee/circlee">Circlee</a> is maintained by <a href="https://github.com/circlee">circlee</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>



<script src="https://unpkg.com/vue@2.2.1"></script>
<script src="https://www.gstatic.com/firebasejs/3.7.0/firebase.js"></script>
<script>

  var main = new Vue({
    el : '.main-content'
    ,data : {
      msgData : { test : 123}
    }
    ,methods : {
      setData : function(data){
        if(data) {
          this.msgData = data;
        }
        
      }
      , setDataValue : function(key , val) {
        if(key) {
          this.msgData[key] = val;
        }
        
      }
      , delDataValue : function(key) {
        if(key) {
          this.msgData[key];
        }
      }
    }

  });

  
  function serialize(obj) {
    var str = [];
    for(var p in obj)
      if (obj.hasOwnProperty(p)) {
        str.push(encodeURIComponent(p) + "=" + encodeURIComponent(obj[p]));
      }
    return str.join("&");
  }

  var isAuthorized = false;

  // Initialize Firebase
  var config = {
    apiKey: "AIzaSyAR8iE1IMTAwro83q0QxKJ8HPrwDQV2Ouc",
    authDomain: "circlee7-e6f11.firebaseapp.com",
    databaseURL: "https://circlee7-e6f11.firebaseio.com",
    storageBucket: "circlee7-e6f11.appspot.com",
    messagingSenderId: "859881315121"
  };
  firebase.initializeApp(config);

  function checkAuthorized( fnc ){
    if(!isAuthorized) {
      var provider = new firebase.auth.GithubAuthProvider(); 
      firebase.auth().signInWithPopup(provider).then(function(result) {
        isAuthorized = true;
        // ...

        fnc();
      }).catch(function(error) {
        console.error(error)
        return false;
      });
    } else {
      fnc();
    }
  }

  function writeMsg(msgId, msg) {
    checkAuthorized( function(){
      firebase.database().ref('msgs/' + msgId).set({
        msg : msg
      });
    })
    
  }

  var startMsgRef = firebase.database().ref('msgs/');
  startMsgRef.on('value', function(snapshot) {
    main.setData(snapshot.val());
  });

  var msgRefs = firebase.database().ref('msgs/');
  msgRefs.on('child_added', function(data) {
    main.setDataValue(data.key , data.val());
  });

  msgRefs.on('child_changed', function(data) {
    main.setDataValue(data.key , data.val());
  });

  msgRefs.on('child_removed', function(data) {
    main.delDataValue(data.key);
  });


</script>
  
  </body>
</html>
